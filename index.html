<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conquistadores - Gesti√≥n Integral</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Recharts -->
    <script src="https://unpkg.com/recharts/umd/Recharts.min.js"></script>
    
    <!-- FIREBASE -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: { 50:'#fdf2f8', 100:'#fce7f3', 500:'#ec4899', 600:'#db2777', 700:'#be185d', 900:'#831843' }, // Pink/Rose Moderno
                        dark: { 800: '#1e293b', 900: '#0f172a' }
                    },
                    fontFamily: { sans: ['Plus Jakarta Sans', 'sans-serif'] }
                }
            }
        }
    </script>
    <style>
        body { background-color: #f8fafc; color: #1e293b; }
        .glass-panel { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.5); }
        .input-std { @apply w-full bg-white border border-slate-200 text-slate-700 text-sm rounded-xl focus:ring-2 focus:ring-brand-500 focus:border-brand-500 block p-3 transition-all outline-none shadow-sm; }
        .label-std { @apply block mb-1.5 text-xs font-bold text-slate-500 uppercase tracking-wider; }
        .btn-primary { @apply text-white bg-brand-600 hover:bg-brand-700 focus:ring-4 focus:ring-brand-300 font-bold rounded-xl text-sm px-6 py-3 focus:outline-none transition-all shadow-lg shadow-brand-500/30 active:scale-95 flex items-center justify-center gap-2; }
        .btn-secondary { @apply text-slate-700 bg-white border border-slate-200 hover:bg-slate-50 focus:ring-4 focus:ring-slate-100 font-bold rounded-xl text-sm px-6 py-3 focus:outline-none transition-all active:scale-95 flex items-center justify-center gap-2 shadow-sm; }
        .card-hover { @apply hover:shadow-lg transition-all duration-300 hover:-translate-y-1; }
        
        /* Scrollbar Hide */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        .fade-enter { animation: fadeEnter 0.4s ease-out forwards; }
        @keyframes fadeEnter { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // --- CONFIGURACI√ìN FIREBASE ---
        const firebaseConfig = {
            apiKey: "AIzaSyDXK_EcXsFGhRmXfkKG8SMdsM69c4PNfHw",
            authDomain: "conquistadoresapp.firebaseapp.com",
            projectId: "conquistadoresapp",
            storageBucket: "conquistadoresapp.firebasestorage.app",
            messagingSenderId: "518647225464",
            appId: "1:518647225464:web:b3344ca5172498187e218d"
        };
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();
        const googleProvider = new firebase.auth.GoogleAuthProvider();

        // --- ICONOS (CORREGIDOS) ---
        const Icon = ({ name, size = 20, className = "" }) => {
            const icons = {
                Home: <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>,
                Users: <React.Fragment><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></React.Fragment>,
                Wallet: <React.Fragment><path d="M20 12V8H6a2 2 0 0 1 0-4h14v4"/><path d="M4 6v12a2 2 0 0 0 2 2h14v-4"/><path d="M18 12a2 2 0 0 0 0 4h4v-4z"/></React.Fragment>,
                Music: <React.Fragment><path d="M9 18V5l12-2v13"/><circle cx="6" cy="18" r="3"/><circle cx="18" cy="16" r="3"/></React.Fragment>,
                Book: <React.Fragment><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></React.Fragment>,
                Calendar: <React.Fragment><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></React.Fragment>,
                Mail: <React.Fragment><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></React.Fragment>,
                Menu: <React.Fragment><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></React.Fragment>,
                X: <React.Fragment><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></React.Fragment>,
                Plus: <React.Fragment><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></React.Fragment>,
                Hand: <React.Fragment><path d="M18 11V6a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v0"/><path d="M14 10V4a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v2"/><path d="M10 10.5V6a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v8"/><path d="M18 8a2 2 0 1 1 4 0v6a8 8 0 0 1-8 8h-2c-2.8 0-4.5-.86-5.99-2.34l-3.6-3.6a2 2 0 0 1 2.83-2.82L7 15"/></React.Fragment>,
                ChevronLeft: <polyline points="15 18 9 12 15 6"/>,
                ChevronRight: <polyline points="9 18 15 12 9 6"/>,
                Check: <polyline points="20 6 9 17 4 12"/>,
                Clock: <React.Fragment><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></React.Fragment>,
                Chart: <React.Fragment><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></React.Fragment>,
                LogOut: <React.Fragment><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></React.Fragment>,
                Smile: <React.Fragment><circle cx="12" cy="12" r="10"/><path d="M8 14s1.5 2 4 2 4-2 4-2"/><line x1="9" y1="9" x2="9.01" y2="9"/><line x1="15" y1="9" x2="15.01" y2="9"/></React.Fragment>,
                Trash: <React.Fragment><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></React.Fragment>
            };
            return <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>{icons[name] || <circle cx="12" cy="12" r="10"/>}</svg>;
        };

        const { useState, useEffect, useMemo } = React;
        const { BarChart, Bar, XAxis, YAxis, Tooltip, ResponsiveContainer, Cell } = window.Recharts;

        // --- UTILS ---
        const formatDate = (d) => {
            if(!d) return '';
            const date = new Date(d + 'T00:00:00');
            return date.toLocaleDateString('es-AR', { day: 'numeric', month: 'long' });
        };
        const formatMoney = (v) => new Intl.NumberFormat('es-AR', { style: 'currency', currency: 'ARS', minimumFractionDigits: 0 }).format(v);
        const getMonthName = (m) => new Date(2024, m, 1).toLocaleDateString('es-AR', { month: 'long' });

        // --- COMPONENTES UI GEN√âRICOS ---
        
        const MonthNavigator = ({ currentMonth, currentYear, onChange }) => {
            const months = Array.from({ length: 12 }, (_, i) => i);
            return (
                <div className="flex items-center gap-4 bg-white p-3 rounded-2xl shadow-sm border border-slate-100 mb-8 overflow-x-auto no-scrollbar">
                    <button onClick={() => onChange('prev')} className="p-2 hover:bg-slate-50 text-slate-400 hover:text-brand-600 rounded-full transition-colors"><Icon name="ChevronLeft"/></button>
                    <div className="flex gap-2">
                        {months.map(m => (
                            <button key={m} 
                                onClick={() => onChange(m)}
                                className={`px-5 py-2 rounded-full text-sm font-bold transition-all whitespace-nowrap ${currentMonth === m ? 'bg-brand-600 text-white shadow-lg shadow-brand-500/30 transform scale-105' : 'text-slate-400 hover:bg-slate-50 hover:text-slate-600'}`}>
                                {getMonthName(m)}
                            </button>
                        ))}
                    </div>
                    <button onClick={() => onChange('next')} className="p-2 hover:bg-slate-50 text-slate-400 hover:text-brand-600 rounded-full transition-colors"><Icon name="ChevronRight"/></button>
                    <span className="font-extrabold text-slate-800 text-lg px-2 tracking-tight">{currentYear}</span>
                </div>
            );
        };

        const MultiSelect = ({ options, selected = [], onChange, label }) => {
            const toggle = (val) => {
                if (selected.includes(val)) onChange(selected.filter(x => x !== val));
                else onChange([...selected, val]);
            };
            return (
                <div className="mb-6">
                    <label className="label-std">{label}</label>
                    <div className="flex flex-wrap gap-2 max-h-40 overflow-y-auto p-3 border border-slate-200 rounded-xl bg-slate-50">
                        {options.map(opt => (
                            <button key={opt.id || opt} onClick={() => toggle(opt.name || opt)}
                                className={`text-xs px-3 py-1.5 rounded-full border transition-all flex items-center gap-1 ${selected.includes(opt.name || opt) ? 'bg-brand-100 border-brand-300 text-brand-700 font-bold' : 'bg-white border-slate-200 text-slate-600 hover:border-slate-300 hover:bg-slate-50'}`}>
                                {selected.includes(opt.name || opt) && <Icon name="Check" size={12}/>}
                                {opt.name || opt}
                            </button>
                        ))}
                    </div>
                </div>
            );
        };

        const ExpandableCard = ({ title, subtitle, date, children, badge, onClick, isTask }) => {
            const [expanded, setExpanded] = useState(false);
            const toggle = (e) => {
                e.stopPropagation();
                if(onClick) onClick();
                else setExpanded(!expanded);
            }
            return (
                <div className={`bg-white rounded-2xl shadow-sm border border-slate-100 hover:shadow-md transition-all overflow-hidden mb-3 ${isTask ? 'border-l-4 border-l-amber-400' : ''}`}>
                    <div className="p-5 cursor-pointer flex justify-between items-center" onClick={toggle}>
                        <div className="flex items-center gap-4">
                            <div className={`w-12 h-12 rounded-2xl flex items-center justify-center font-bold text-lg shadow-sm ${isTask ? 'bg-amber-100 text-amber-600' : 'bg-brand-50 text-brand-600'}`}>
                                {isTask ? <Icon name="Clock" size={24}/> : (title ? title.charAt(0) : '-')}
                            </div>
                            <div>
                                <h4 className="font-bold text-slate-800 text-lg">{title}</h4>
                                <p className="text-sm text-slate-500 font-medium">{subtitle} <span className="text-slate-300 mx-1">‚Ä¢</span> <span className="text-slate-400">{date}</span></p>
                            </div>
                        </div>
                        <div className="flex items-center gap-3">
                            {badge && <span className="px-3 py-1 bg-blue-50 text-blue-600 text-[10px] font-bold uppercase rounded-lg tracking-wider border border-blue-100">{badge}</span>}
                            <div className={`p-2 rounded-full hover:bg-slate-50 text-slate-400 transition-transform duration-300 ${expanded ? '-rotate-90' : 'rotate-90'}`}>
                                <Icon name="ChevronRight"/>
                            </div>
                        </div>
                    </div>
                    {children && expanded && (
                        <div className="px-5 pb-5 pt-0 border-t border-slate-50 bg-slate-50/50">
                            <div className="pt-4 animate-fadeIn text-slate-600 leading-relaxed text-sm">{children}</div>
                        </div>
                    )}
                </div>
            );
        };

        // --- MODAL DETALLE DE EVENTO (MEGA VISOR) ---
        const EventDetailModal = ({ date, data, onClose }) => {
            if (!date) return null;
            // Unir toda la info disponible para esta fecha
            const worship = data.worship.find(w => w.date === date);
            const server = data.servers.find(s => s.date === date);
            const ebd = data.ebd.find(e => e.date === date);
            const youth = data.youth.find(y => y.date === date);

            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-md fade-enter">
                    <div className="bg-white rounded-3xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-y-auto">
                        <div className="sticky top-0 bg-white/95 backdrop-blur-sm z-10 p-6 border-b border-slate-100 flex justify-between items-center">
                            <div>
                                <p className="text-xs font-bold text-brand-600 uppercase tracking-widest mb-1">Organizaci√≥n Integral</p>
                                <h2 className="text-3xl font-extrabold text-slate-900">{formatDate(date)}</h2>
                            </div>
                            <button onClick={onClose} className="p-2 hover:bg-slate-100 rounded-full transition-colors text-slate-400 hover:text-slate-600"><Icon name="X" size={24}/></button>
                        </div>
                        <div className="p-8 space-y-8 bg-slate-50/50 min-h-[50vh]">
                            {/* Header del Evento (Predicador) */}
                            {server?.preacher && (
                                <div className="text-center p-8 bg-white rounded-3xl border border-brand-100 shadow-sm relative overflow-hidden">
                                    <div className="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-brand-400 to-purple-500"></div>
                                    <p className="text-xs text-brand-500 font-bold uppercase mb-2 tracking-widest">Palabra & Mensaje</p>
                                    <h3 className="text-2xl font-black text-slate-900 mb-2">"{server.preacher}"</h3>
                                    <p className="text-slate-500 font-medium italic">Tipo de reuni√≥n: {server.type}</p>
                                </div>
                            )}

                            {!worship && !server && !ebd && !youth && (
                                <div className="text-center py-12">
                                    <div className="w-16 h-16 bg-slate-200 rounded-full mx-auto flex items-center justify-center text-slate-400 mb-4"><Icon name="Calendar" size={32}/></div>
                                    <p className="text-slate-500 font-medium">No hay actividades registradas para esta fecha.</p>
                                </div>
                            )}

                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                {/* Alabanza */}
                                {worship && (
                                    <div className="bg-white p-6 rounded-2xl border border-slate-200 shadow-sm card-hover">
                                        <div className="flex items-center gap-3 mb-6 pb-4 border-b border-slate-50">
                                            <div className="p-2 bg-purple-50 text-purple-600 rounded-lg"><Icon name="Music"/></div>
                                            <h4 className="font-bold text-slate-800 text-lg">Alabanza</h4>
                                        </div>
                                        <div className="mb-4">
                                            <p className="text-xs text-slate-400 uppercase font-bold mb-1">Tema Principal</p>
                                            <p className="font-bold text-slate-800 text-lg">{worship.theme}</p>
                                        </div>
                                        <div className="space-y-3 mb-6">
                                            {Object.entries(worship.team || {}).map(([inst, ppl]) => (
                                                <div key={inst} className="flex justify-between items-center text-sm">
                                                    <span className="text-slate-500 font-medium">{inst}</span>
                                                    <span className="font-bold text-slate-800 bg-slate-50 px-2 py-1 rounded-md">{ppl.join(', ')}</span>
                                                </div>
                                            ))}
                                        </div>
                                        {worship.songList?.length > 0 && (
                                            <div className="bg-slate-50 p-4 rounded-xl border border-slate-100">
                                                <p className="text-xs font-bold text-slate-400 uppercase mb-3 flex items-center gap-2"><Icon name="Check" size={14}/> Setlist</p>
                                                <ul className="space-y-2">
                                                    {worship.songList.map((s,i) => (
                                                        <li key={i} className="text-sm text-slate-600 font-medium flex gap-2">
                                                            <span className="text-slate-300 font-bold">{i+1}.</span> {s}
                                                        </li>
                                                    ))}
                                                </ul>
                                            </div>
                                        )}
                                    </div>
                                )}

                                {/* Servidores */}
                                {server && (
                                    <div className="bg-white p-6 rounded-2xl border border-slate-200 shadow-sm card-hover">
                                        <div className="flex items-center gap-3 mb-6 pb-4 border-b border-slate-50">
                                            <div className="p-2 bg-blue-50 text-blue-600 rounded-lg"><Icon name="Hand"/></div>
                                            <h4 className="font-bold text-slate-800 text-lg">Servidores</h4>
                                        </div>
                                        <div className="grid grid-cols-1 gap-4">
                                            {Object.entries(server.assignments || {}).map(([role, ppl]) => (
                                                <div key={role} className="bg-slate-50 p-3 rounded-xl border border-slate-100">
                                                    <p className="text-xs font-bold text-slate-400 uppercase mb-1">{role}</p>
                                                    <p className="font-bold text-slate-800 text-sm">{Array.isArray(ppl) ? ppl.join(', ') : ppl}</p>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}
                            </div>
                            
                            {/* Otros Ministerios */}
                            {(ebd || youth) && (
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    {ebd && (
                                        <div className="p-6 bg-emerald-50 rounded-2xl border border-emerald-100 shadow-sm">
                                            <h4 className="font-bold text-emerald-900 mb-2 flex gap-2 items-center"><Icon name="Book"/> Escuela B√≠blica</h4>
                                            <p className="text-lg font-bold text-emerald-800 mb-1">{ebd.topic}</p>
                                            <p className="text-sm text-emerald-700 opacity-80">Maestros: {ebd.teachers?.join(', ')}</p>
                                        </div>
                                    )}
                                    {youth && (
                                        <div className="p-6 bg-amber-50 rounded-2xl border border-amber-100 shadow-sm">
                                            <h4 className="font-bold text-amber-900 mb-2 flex gap-2 items-center"><Icon name="Smile"/> J√≥venes</h4>
                                            <p className="text-lg font-bold text-amber-800 mb-1">{youth.title}</p>
                                            <p className="text-sm text-amber-700 opacity-80">Lugar: {youth.location}</p>
                                        </div>
                                    )}
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        // --- APP PRINCIPAL ---
        const App = () => {
            // AUTH & USER
            const [user, setUser] = useState(null);
            const [profile, setProfile] = useState(null);
            
            // NAVIGATION & DATE STATE
            const [tab, setTab] = useState('dashboard');
            const [dateState, setDateState] = useState({ month: new Date().getMonth(), year: new Date().getFullYear() });
            const [sidebarOpen, setSidebarOpen] = useState(false);

            // DATA COLLECTIONS
            const [data, setData] = useState({ members: [], worship: [], servers: [], finances: [], songs: [], ebd: [], youth: [], tasks: [], messages: [] });
            
            // MODALS
            const [modalOpen, setModalOpen] = useState(null); // 'plan', 'eventDetail'
            const [selectedDateForDetail, setSelectedDateForDetail] = useState(null);

            // --- LOAD DATA ---
            useEffect(() => {
                const sub = auth.onAuthStateChanged(async (u) => {
                    if (u) {
                        setUser(u);
                        const pSnap = await db.collection('members').where('email','==',u.email).get();
                        if (!pSnap.empty) setProfile({id: pSnap.docs[0].id, ...pSnap.docs[0].data()});
                        else {
                            // Fallback para primer usuario
                            const check = await db.collection('members').get();
                            if(check.empty) {
                                const newP = { name: u.displayName, email: u.email, role: 'Pastor', ministry: 'Pastoral', photo: u.photoURL };
                                db.collection('members').add(newP);
                                setProfile(newP);
                            }
                        }
                    }
                });
                return () => sub();
            }, []);

            useEffect(() => {
                if(!profile) return;
                const cols = ['members','worship','servers','finances','songs','ebd','youth','tasks','messages'];
                const unsubs = cols.map(c => db.collection(c).onSnapshot(s => 
                    setData(prev => ({ ...prev, [c]: s.docs.map(d => ({id: d.id, ...d.data()})) }))
                ));
                return () => unsubs.forEach(u => u());
            }, [profile]);

            // --- HELPERS ---
            const changeMonth = (val) => {
                let { month, year } = dateState;
                if(val === 'prev') { month--; if(month<0){ month=11; year--;} }
                else if(val === 'next') { month++; if(month>11){ month=0; year++;} }
                else { month = val; }
                setDateState({ month, year });
            };

            const filterByMonth = (list) => list.filter(i => {
                const d = new Date(i.date + 'T00:00:00');
                return d.getMonth() === dateState.month && d.getFullYear() === dateState.year;
            });

            // --- VISTAS ---

            const Dashboard = () => {
                const myTasks = data.tasks.filter(t => t.assignedTo === profile.name && t.status !== 'Completada');
                const myServices = useMemo(() => {
                    const arr = [];
                    // Buscar en Alabanza
                    data.worship.filter(w => new Date(w.date) >= new Date()).forEach(w => {
                        Object.entries(w.team || {}).forEach(([inst, ppl]) => {
                            if(ppl.includes(profile.name)) arr.push({date: w.date, title: 'Alabanza', role: inst, detail: w.theme, origin: 'worship'});
                        });
                    });
                    // Buscar en Servidores
                    data.servers.filter(s => new Date(s.date) >= new Date()).forEach(s => {
                        Object.entries(s.assignments || {}).forEach(([role, ppl]) => {
                            if((Array.isArray(ppl) ? ppl : [ppl]).includes(profile.name)) arr.push({date: s.date, title: 'Servidor', role: role, detail: s.type, origin: 'servers'});
                        });
                    });
                    return arr.sort((a,b) => new Date(a.date) - new Date(b.date));
                }, [data, profile]);

                return (
                    <div className="space-y-8 fade-enter">
                        <header className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                            <div>
                                <h2 className="text-4xl font-extrabold text-slate-800 tracking-tight mb-2">Hola, {profile.name.split(' ')[0]} üëã</h2>
                                <p className="text-slate-500 font-medium">Aqu√≠ tienes un resumen de tu actividad ministerial.</p>
                            </div>
                            <button onClick={()=>setModalOpen('plan')} className="btn-primary w-full md:w-auto"><Icon name="Plus"/> Planificar Evento</button>
                        </header>

                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            {/* Columna Izquierda: Mis Cosas */}
                            <div className="lg:col-span-2 space-y-8">
                                <div className="bg-white rounded-3xl p-8 shadow-sm border border-slate-100">
                                    <h3 className="font-bold text-xl mb-6 flex items-center gap-3 text-slate-800"><Icon name="Calendar" className="text-brand-600"/> Mis Pr√≥ximos Servicios</h3>
                                    {myServices.length > 0 ? (
                                        <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                            {myServices.slice(0,4).map((s,i) => (
                                                <div key={i} onClick={()=>{setSelectedDateForDetail(s.date); setModalOpen('eventDetail');}} 
                                                    className="p-5 rounded-2xl bg-slate-50 border border-slate-100 hover:border-brand-300 hover:bg-brand-50 cursor-pointer transition-all group relative overflow-hidden">
                                                    <div className="flex justify-between items-start mb-3 relative z-10">
                                                        <span className="text-xs font-black text-slate-400 uppercase tracking-widest">{formatDate(s.date)}</span>
                                                        <span className="px-2 py-1 rounded-md text-[10px] font-bold bg-white border shadow-sm uppercase">{s.title}</span>
                                                    </div>
                                                    <p className="font-extrabold text-slate-800 text-lg group-hover:text-brand-700 relative z-10">{s.role}</p>
                                                    <p className="text-sm text-slate-500 truncate relative z-10">{s.detail}</p>
                                                </div>
                                            ))}
                                        </div>
                                    ) : (
                                        <div className="text-center py-10 bg-slate-50 rounded-2xl border-2 border-dashed border-slate-200">
                                            <p className="text-slate-400 font-medium">No tienes asignaciones pr√≥ximas. ¬°Descansa!</p>
                                        </div>
                                    )}
                                </div>

                                <div className="bg-gradient-to-br from-brand-600 to-rose-700 rounded-3xl p-8 text-white shadow-xl shadow-brand-500/20 relative overflow-hidden">
                                    <div className="absolute top-0 right-0 w-64 h-64 bg-white/10 rounded-full blur-3xl -translate-y-1/2 translate-x-1/2"></div>
                                    <h3 className="font-bold text-xl mb-4 flex items-center gap-2 relative z-10"><Icon name="Clock"/> Tareas Pendientes</h3>
                                    <div className="space-y-3 relative z-10">
                                        {myTasks.slice(0,3).map(t => (
                                            <div key={t.id} onClick={()=>{setSelectedDateForDetail(t.targetDate || t.dueDate); setModalOpen('eventDetail');}}
                                                className="bg-white/10 backdrop-blur-md p-4 rounded-xl flex justify-between items-center cursor-pointer hover:bg-white/20 transition-all border border-white/10">
                                                <span className="font-medium">{t.description}</span>
                                                <span className="text-xs bg-white text-brand-700 px-3 py-1 rounded-full font-bold shadow-sm">{t.dueDate}</span>
                                            </div>
                                        ))}
                                        {myTasks.length === 0 && <p className="opacity-80 text-sm font-medium">Todo al d√≠a. ¬°Buen trabajo!</p>}
                                    </div>
                                    <button onClick={()=>setTab('messages')} className="mt-6 text-xs font-bold uppercase tracking-widest hover:underline bg-white/20 px-4 py-2 rounded-lg backdrop-blur-sm">Ir al Centro de Mensajes</button>
                                </div>
                            </div>

                            {/* Columna Derecha: M√©tricas y Accesos */}
                            <div className="space-y-8">
                                <div className="bg-white rounded-3xl p-6 shadow-sm border border-slate-100">
                                    <h3 className="font-bold text-lg mb-6 text-slate-800">Rotaci√≥n de Servidores</h3>
                                    <div className="h-48">
                                        <ResponsiveContainer width="100%" height="100%">
                                            <BarChart data={data.servers.flatMap(s=>Object.values(s.assignments||{})).flat().reduce((acc, curr)=>{
                                                const existing = acc.find(x=>x.name===curr);
                                                if(existing) existing.count++; else acc.push({name: curr, count: 1});
                                                return acc;
                                            }, []).sort((a,b)=>b.count-a.count).slice(0,5)}>
                                                <XAxis dataKey="name" tick={{fontSize: 10, fill: '#64748b'}} interval={0} axisLine={false} tickLine={false} />
                                                <Tooltip cursor={{fill: '#f1f5f9'}} contentStyle={{borderRadius: '12px', border: 'none', boxShadow: '0 10px 15px -3px rgba(0, 0, 0, 0.1)'}} />
                                                <Bar dataKey="count" fill="#ec4899" radius={[6,6,6,6]} barSize={20} />
                                            </BarChart>
                                        </ResponsiveContainer>
                                    </div>
                                    <p className="text-center text-xs text-slate-400 mt-4">Top 5 servidores activos este mes</p>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            };

            const NotificationsCenter = () => {
                const myInbox = data.messages.filter(m => m.to === 'all' || m.to === profile.id);
                return (
                    <div className="fade-enter max-w-5xl mx-auto">
                        <div className="flex justify-between items-center mb-8">
                             <h2 className="text-3xl font-extrabold text-slate-800">Centro de Mensajes</h2>
                             <div className="bg-white px-4 py-2 rounded-full text-sm font-bold text-slate-500 border border-slate-200 shadow-sm">{myInbox.length} Mensajes</div>
                        </div>
                        
                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            <div className="lg:col-span-2 space-y-4">
                                {myInbox.map(m => (
                                    <ExpandableCard key={m.id} title={m.fromName} subtitle={formatDate(m.date.split('T')[0])} date={m.date.split('T')[1]?.substring(0,5)} badge={m.to==='all'?'Difusi√≥n':null}>
                                        <p className="text-slate-700 whitespace-pre-line leading-relaxed">{m.content}</p>
                                    </ExpandableCard>
                                ))}
                                {myInbox.length === 0 && <div className="text-center p-10 text-slate-400">No hay mensajes.</div>}
                            </div>
                            <div className="bg-white p-6 rounded-3xl border border-slate-100 h-fit sticky top-6 shadow-sm">
                                <h3 className="font-bold text-lg mb-6 flex items-center gap-2 text-slate-800"><Icon name="Check"/> Mis Tareas</h3>
                                <div className="space-y-4">
                                    {data.tasks.filter(t => t.assignedTo === profile.name).map(t => (
                                        <div key={t.id} className="group p-4 rounded-xl bg-slate-50 border border-slate-100 hover:bg-white hover:shadow-md transition-all cursor-pointer" onClick={()=>{setSelectedDateForDetail(t.dueDate); setModalOpen('eventDetail');}}>
                                            <div className="flex justify-between mb-2">
                                                <p className="font-bold text-slate-800 text-sm">{t.description}</p>
                                                <span className="text-[10px] bg-amber-100 text-amber-700 px-2 py-1 rounded-full font-bold">{t.dueDate}</span>
                                            </div>
                                            <p className="text-xs text-blue-500 font-bold opacity-0 group-hover:opacity-100 transition-opacity">Ver contexto completo ‚Üí</p>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>
                    </div>
                );
            };

            const CalendarView = () => {
                const daysInMonth = new Date(dateState.year, dateState.month + 1, 0).getDate();
                const firstDay = new Date(dateState.year, dateState.month, 1).getDay();
                
                const eventsByDate = {};
                [...data.worship, ...data.servers, ...data.ebd, ...data.youth].forEach(e => {
                    if(!eventsByDate[e.date]) eventsByDate[e.date] = [];
                    eventsByDate[e.date].push(e);
                });

                return (
                    <div className="fade-enter h-full flex flex-col">
                        <div className="flex justify-between items-center mb-6">
                            <h2 className="text-3xl font-extrabold text-slate-800">Calendario Global</h2>
                            <MonthNavigator currentMonth={dateState.month} currentYear={dateState.year} onChange={changeMonth} />
                        </div>
                        <div className="bg-white rounded-3xl shadow-sm border border-slate-200 flex-1 grid grid-cols-7 grid-rows-[auto_1fr] overflow-hidden">
                            {['DOM','LUN','MAR','MI√â','JUE','VIE','S√ÅB'].map(d => <div key={d} className="p-4 text-center text-xs font-black text-slate-400 tracking-widest border-b border-slate-100 bg-slate-50/50">{d}</div>)}
                            
                            <div className="col-span-7 grid grid-cols-7 auto-rows-fr">
                                {Array.from({length: firstDay}).map((_,i) => <div key={`e-${i}`} className="bg-slate-50/30 border-b border-r border-slate-50"/>)}
                                {Array.from({length: daysInMonth}).map((_,i) => {
                                    const d = i+1;
                                    const dateStr = `${dateState.year}-${String(dateState.month+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
                                    const evs = eventsByDate[dateStr] || [];
                                    return (
                                        <div key={d} onClick={()=>{if(evs.length){setSelectedDateForDetail(dateStr); setModalOpen('eventDetail');}}}
                                            className={`p-3 border-b border-r border-slate-100 min-h-[120px] relative transition-all group ${evs.length ? 'cursor-pointer hover:bg-brand-50/30' : ''}`}>
                                            <span className={`text-sm font-bold w-8 h-8 flex items-center justify-center rounded-full ${evs.length ? 'bg-brand-600 text-white shadow-md' : 'text-slate-400'}`}>{d}</span>
                                            <div className="mt-3 space-y-1.5">
                                                {evs.map((e, idx) => (
                                                    <div key={idx} className={`text-[10px] px-2 py-1 rounded-md truncate font-bold shadow-sm transition-transform group-hover:scale-105 ${e.theme ? 'bg-purple-100 text-purple-700' : (e.assignments ? 'bg-blue-100 text-blue-700' : 'bg-emerald-100 text-emerald-700')}`}>
                                                        {e.theme || e.type || e.title}
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>
                        </div>
                    </div>
                );
            };

            const MinistryManager = ({ ministry }) => {
                const isWorship = ministry === 'Alabanza';
                const collection = isWorship ? 'worship' : 'servers';
                const filteredList = filterByMonth(data[collection]).sort((a,b)=>new Date(a.date)-new Date(b.date));
                const [form, setForm] = useState(isWorship ? { team: {} } : { assignments: {} });
                const [isFormOpen, setIsFormOpen] = useState(false);

                const roles = isWorship 
                    ? ['Vocal', 'Guitarra A.', 'Guitarra E.', 'Bajo', 'Bater√≠a', 'Teclado'] 
                    : ['Ba√±os', 'Altar', 'Ofrenda', 'Autos', 'Recepci√≥n', 'Limpieza'];
                
                const availablePeople = data.members.filter(m => m.ministry === ministry || m.ministry === 'General' || m.role === 'Pastor');

                const handleMultiSelect = (role, selectedArr) => {
                    const field = isWorship ? 'team' : 'assignments';
                    setForm(prev => ({ ...prev, [field]: { ...prev[field], [role]: selectedArr } }));
                };

                const saveData = () => {
                    db.collection(collection).add(form);
                    setIsFormOpen(false);
                    setForm(isWorship ? { team: {} } : { assignments: {} });
                };

                return (
                    <div className="fade-enter space-y-8">
                        <div className="flex flex-col md:flex-row justify-between items-center gap-4">
                            <div>
                                <h2 className="text-3xl font-extrabold text-slate-800 tracking-tight">{ministry}</h2>
                                <p className="text-slate-500 font-medium">Gesti√≥n y Planificaci√≥n</p>
                            </div>
                            <MonthNavigator currentMonth={dateState.month} currentYear={dateState.year} onChange={changeMonth} />
                        </div>
                        
                        <button onClick={()=>{setIsFormOpen(true); setForm(prev=>({...prev, date: ''}));}} className="w-full py-6 border-2 border-dashed border-slate-300 rounded-3xl text-slate-500 font-bold hover:border-brand-400 hover:text-brand-600 hover:bg-brand-50 transition-all flex flex-col items-center gap-2">
                            <Icon name="Plus" size={32}/>
                            <span>Agregar Evento en {getMonthName(dateState.month)}</span>
                        </button>

                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            {filteredList.map(item => (
                                <div key={item.id} className="bg-white p-6 rounded-3xl border border-slate-100 shadow-sm hover:shadow-xl transition-all cursor-pointer group hover:-translate-y-1" onClick={()=>{setSelectedDateForDetail(item.date); setModalOpen('eventDetail');}}>
                                    <div className="flex justify-between items-start mb-4">
                                        <div className="bg-slate-50 px-3 py-1 rounded-lg border border-slate-200">
                                            <p className="font-black text-slate-800 text-lg leading-none">{new Date(item.date + 'T00:00:00').getDate()}</p>
                                            <p className="text-[10px] font-bold text-slate-400 uppercase text-center">{new Date(item.date + 'T00:00:00').toLocaleDateString('es-AR',{month:'short'})}</p>
                                        </div>
                                        <p className="text-sm font-bold text-slate-500 bg-slate-50 px-2 py-1 rounded-md">{item.time} hs</p>
                                    </div>
                                    <div className="mb-4">
                                        <p className="font-extrabold text-lg text-slate-800 leading-tight mb-1">{item.theme || item.type}</p>
                                        {!isWorship && item.preacher && <p className="text-xs text-slate-500 font-medium bg-slate-50 inline-block px-2 py-1 rounded">Predica: {item.preacher}</p>}
                                    </div>
                                    <div className="flex flex-wrap gap-1">
                                        {Object.values(isWorship ? item.team : item.assignments).flat().slice(0,4).map((p, i) => (
                                            <span key={i} className="text-[10px] font-bold bg-brand-50 text-brand-700 px-2 py-1 rounded-md border border-brand-100">{p}</span>
                                        ))}
                                        {Object.values(isWorship ? item.team : item.assignments).flat().length > 4 && <span className="text-[10px] text-slate-400 font-bold self-center">+ m√°s</span>}
                                    </div>
                                </div>
                            ))}
                        </div>

                        {isFormOpen && (
                            <div className="fixed inset-0 bg-slate-900/50 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
                                <div className="bg-white rounded-3xl p-8 w-full max-w-2xl max-h-[90vh] overflow-y-auto shadow-2xl">
                                    <h3 className="font-extrabold text-2xl text-slate-800 mb-6">Planificar {ministry}</h3>
                                    <div className="grid grid-cols-2 gap-6 mb-6">
                                        <div><label className="label-std">Fecha</label><input type="date" className="input-std" onChange={e=>setForm({...form, date:e.target.value})}/></div>
                                        <div><label className="label-std">Hora</label><input type="time" className="input-std" onChange={e=>setForm({...form, time:e.target.value})}/></div>
                                    </div>
                                    <div className="mb-6">
                                        <label className="label-std">{isWorship ? 'Tema' : 'Tipo de Evento'}</label>
                                        <input className="input-std" onChange={e=>setForm({...form, [isWorship?'theme':'type']:e.target.value})}/>
                                    </div>
                                    {!isWorship && (
                                        <div className="mb-6"><label className="label-std">Predicador</label><input className="input-std" onChange={e=>setForm({...form, preacher:e.target.value})}/></div>
                                    )}
                                    <div className="border-t border-slate-100 pt-6">
                                        <p className="font-bold text-lg mb-4 text-slate-800">Asignaci√≥n de Equipo</p>
                                        <div className="grid grid-cols-1 sm:grid-cols-2 gap-x-8">
                                            {roles.map(role => (
                                                <MultiSelect key={role} label={role} options={availablePeople} 
                                                    selected={(isWorship ? form.team : form.assignments)?.[role] || []}
                                                    onChange={(val) => handleMultiSelect(role, val)}
                                                />
                                            ))}
                                        </div>
                                    </div>
                                    <div className="flex gap-4 mt-8">
                                        <button onClick={()=>setIsFormOpen(false)} className="btn-secondary w-full">Cancelar</button>
                                        <button onClick={saveData} className="btn-primary w-full">Guardar Planificaci√≥n</button>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                );
            };

            const Finances = () => {
                const list = filterByMonth(data.finances);
                const [form, setForm] = useState({ type: 'Culto', tithes: 0, offerings: 0, notes: '', date: new Date().toISOString().split('T')[0] });
                const [showForm, setShowForm] = useState(false);

                const totalTithes = list.reduce((acc, curr) => acc + (Number(curr.tithes)||0), 0);
                const totalOfferings = list.reduce((acc, curr) => acc + (Number(curr.offerings)||0), 0);
                const totalExpenses = list.filter(x=>x.type==='Gasto').reduce((acc, curr) => acc + (Number(curr.amount)||0), 0);

                const saveFinance = () => {
                    db.collection('finances').add(form);
                    setShowForm(false);
                };

                return (
                    <div className="fade-enter space-y-8">
                        <div className="flex flex-col md:flex-row justify-between items-center gap-4">
                            <h2 className="text-3xl font-extrabold text-slate-800">Tesorer√≠a</h2>
                            <MonthNavigator currentMonth={dateState.month} currentYear={dateState.year} onChange={changeMonth} />
                        </div>

                        <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div className="bg-emerald-50 border border-emerald-100 p-8 rounded-3xl text-emerald-900 shadow-sm relative overflow-hidden">
                                <div className="absolute top-0 right-0 p-4 opacity-10"><Icon name="Wallet" size={64}/></div>
                                <p className="text-xs font-bold uppercase tracking-widest mb-2">Total Diezmos</p>
                                <p className="text-4xl font-black">{formatMoney(totalTithes)}</p>
                            </div>
                            <div className="bg-blue-50 border border-blue-100 p-8 rounded-3xl text-blue-900 shadow-sm relative overflow-hidden">
                                <div className="absolute top-0 right-0 p-4 opacity-10"><Icon name="Chart" size={64}/></div>
                                <p className="text-xs font-bold uppercase tracking-widest mb-2">Total Ofrendas</p>
                                <p className="text-4xl font-black">{formatMoney(totalOfferings)}</p>
                            </div>
                            <div className="bg-rose-50 border border-rose-100 p-8 rounded-3xl text-rose-900 shadow-sm relative overflow-hidden">
                                <div className="absolute top-0 right-0 p-4 opacity-10"><Icon name="Trash" size={64}/></div>
                                <p className="text-xs font-bold uppercase tracking-widest mb-2">Gastos del Mes</p>
                                <p className="text-4xl font-black">{formatMoney(totalExpenses)}</p>
                            </div>
                        </div>

                        <div className="flex justify-end gap-3">
                            <button onClick={()=>{setForm(prev=>({...prev, type:'Gasto'})); setShowForm(true);}} className="btn-secondary text-rose-600 border-rose-200 hover:bg-rose-50">Registrar Gasto</button>
                            <button onClick={()=>{setForm(prev=>({...prev, type:'Culto'})); setShowForm(true);}} className="btn-primary">Cierre de Culto</button>
                        </div>

                        <div className="bg-white rounded-3xl border border-slate-200 shadow-sm overflow-hidden">
                            <table className="w-full text-sm text-left">
                                <thead className="bg-slate-50 text-slate-500 font-bold uppercase text-xs">
                                    <tr><th className="p-5">Fecha</th><th className="p-5">Concepto</th><th className="p-5 text-right">Diezmos</th><th className="p-5 text-right">Ofrendas</th><th className="p-5 text-right">Total</th></tr>
                                </thead>
                                <tbody>
                                    {list.map(f => (
                                        <tr key={f.id} className="border-t border-slate-100 hover:bg-slate-50 transition-colors">
                                            <td className="p-5 font-bold text-slate-700">{formatDate(f.date)}</td>
                                            <td className="p-5"><span className={`px-2 py-1 rounded-md text-xs font-bold uppercase tracking-wider mr-2 ${f.type==='Gasto'?'bg-rose-100 text-rose-700':'bg-emerald-100 text-emerald-700'}`}>{f.type}</span> {f.notes}</td>
                                            <td className="p-5 text-right text-slate-500">{f.tithes ? formatMoney(f.tithes) : '-'}</td>
                                            <td className="p-5 text-right text-slate-500">{f.offerings ? formatMoney(f.offerings) : '-'}</td>
                                            <td className="p-5 text-right font-black text-slate-800">
                                                {f.type === 'Gasto' ? <span className="text-rose-500">-{formatMoney(f.amount)}</span> : formatMoney((Number(f.tithes)||0) + (Number(f.offerings)||0))}
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>

                        {showForm && (
                            <div className="fixed inset-0 bg-slate-900/50 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
                                <div className="bg-white rounded-3xl p-8 w-full max-w-md shadow-2xl">
                                    <h3 className="font-extrabold text-2xl text-slate-800 mb-6">{form.type === 'Gasto' ? 'Registrar Gasto' : 'Cierre de Caja'}</h3>
                                    <div className="mb-4">
                                        <label className="label-std">Fecha</label>
                                        <input type="date" className="input-std" value={form.date} onChange={e=>setForm({...form, date:e.target.value})}/>
                                    </div>
                                    <div className="mb-4">
                                        <label className="label-std">Detalle / Notas</label>
                                        <input className="input-std" placeholder="Descripci√≥n..." onChange={e=>setForm({...form, notes:e.target.value})}/>
                                    </div>
                                    
                                    {form.type === 'Culto' ? (
                                        <div className="grid grid-cols-2 gap-4">
                                            <div><label className="label-std">Diezmos</label><input type="number" className="input-std" onChange={e=>setForm({...form, tithes:e.target.value})}/></div>
                                            <div><label className="label-std">Ofrendas</label><input type="number" className="input-std" onChange={e=>setForm({...form, offerings:e.target.value})}/></div>
                                        </div>
                                    ) : (
                                        <div><label className="label-std">Monto Gasto</label><input type="number" className="input-std" onChange={e=>setForm({...form, amount:e.target.value})}/></div>
                                    )}
                                    <div className="flex gap-3 mt-8">
                                        <button onClick={()=>setShowForm(false)} className="btn-secondary w-full">Cancelar</button>
                                        <button onClick={saveFinance} className="btn-primary w-full">Guardar</button>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                );
            };

            // --- RENDER ---
            if (!user) return (
                <div className="min-h-screen flex items-center justify-center bg-slate-50 p-4">
                    <div className="bg-white p-10 rounded-3xl shadow-2xl text-center max-w-md w-full border border-slate-100">
                        <div className="w-20 h-20 bg-brand-600 rounded-3xl mx-auto flex items-center justify-center text-white mb-6 shadow-lg shadow-brand-500/40">
                            <Icon name="Home" size={40}/>
                        </div>
                        <h1 className="text-3xl font-extrabold text-slate-900 mb-2">Conquistadores</h1>
                        <p className="text-slate-500 mb-8">Plataforma de Gesti√≥n Integral</p>
                        <button onClick={()=>auth.signInWithPopup(googleProvider)} className="btn-primary w-full py-4 text-lg">
                            Iniciar Sesi√≥n con Google
                        </button>
                    </div>
                </div>
            );

            return (
                <div className="flex h-screen overflow-hidden text-slate-800 bg-slate-50">
                    {/* Sidebar */}
                    <aside className={`fixed md:relative z-40 w-72 bg-dark-900 text-white h-full flex flex-col transition-transform duration-300 shadow-2xl ${sidebarOpen ? 'translate-x-0' : '-translate-x-full md:translate-x-0'}`}>
                        <div className="p-8">
                            <h1 className="font-extrabold text-2xl flex items-center gap-3 tracking-tight"><div className="w-10 h-10 bg-gradient-to-br from-brand-500 to-rose-600 rounded-xl flex items-center justify-center shadow-lg shadow-brand-500/30">C</div> Conquistadores</h1>
                        </div>
                        <nav className="flex-1 px-4 space-y-2">
                            {[
                                {id: 'dashboard', icon: 'Home', label: 'Inicio'},
                                {id: 'calendar', icon: 'Calendar', label: 'Calendario Global'},
                                {id: 'messages', icon: 'Mail', label: 'Notificaciones'},
                                {id: 'worship', icon: 'Music', label: 'Alabanza'},
                                {id: 'servers', icon: 'Hand', label: 'Servidores'},
                                {id: 'finances', icon: 'Wallet', label: 'Tesorer√≠a'},
                            ].map(item => (
                                <button key={item.id} onClick={()=>{setTab(item.id); setSidebarOpen(false);}} 
                                    className={`w-full flex items-center gap-4 px-5 py-4 rounded-2xl text-sm font-bold transition-all ${tab===item.id ? 'bg-brand-600 text-white shadow-lg shadow-brand-900/50' : 'text-slate-400 hover:bg-white/10 hover:text-white'}`}>
                                    <Icon name={item.icon} size={20}/> {item.label}
                                </button>
                            ))}
                        </nav>
                        <div className="p-6 bg-dark-800 mt-auto border-t border-slate-700/50">
                            <div className="flex items-center gap-4">
                                <img src={profile?.photo} className="w-10 h-10 rounded-full border-2 border-brand-500"/>
                                <div className="overflow-hidden">
                                    <p className="text-sm font-bold truncate text-white">{profile?.name}</p>
                                    <button onClick={()=>auth.signOut()} className="text-xs text-slate-400 hover:text-brand-400 flex items-center gap-1 font-bold mt-1 transition-colors"><Icon name="LogOut" size={12}/> Cerrar Sesi√≥n</button>
                                </div>
                            </div>
                        </div>
                    </aside>

                    {/* Main */}
                    <main className="flex-1 h-full overflow-y-auto w-full relative bg-slate-50/50">
                        <header className="md:hidden bg-white p-4 sticky top-0 z-30 flex justify-between items-center shadow-sm border-b border-slate-100">
                            <span className="font-extrabold text-lg text-slate-800">Conquistadores App</span>
                            <button onClick={()=>setSidebarOpen(true)} className="p-2 text-slate-600"><Icon name="Menu"/></button>
                        </header>
                        <div className="p-6 md:p-10 max-w-7xl mx-auto pb-24">
                            {tab === 'dashboard' && <Dashboard />}
                            {tab === 'calendar' && <CalendarView />}
                            {tab === 'messages' && <NotificationsCenter />}
                            {tab === 'worship' && <MinistryManager ministry="Alabanza" />}
                            {tab === 'servers' && <MinistryManager ministry="Servidores" />}
                            {tab === 'finances' && <Finances />}
                        </div>
                    </main>

                    {/* MODAL PLANIFICAR R√ÅPIDO */}
                    {modalOpen === 'plan' && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center bg-slate-900/60 p-4 fade-enter backdrop-blur-sm" onClick={()=>setModalOpen(null)}>
                            <div className="bg-white p-8 rounded-3xl w-full max-w-md shadow-2xl" onClick={e=>e.stopPropagation()}>
                                <h3 className="font-extrabold text-2xl mb-6 text-slate-900">¬øQu√© deseas planificar?</h3>
                                <div className="grid grid-cols-2 gap-4">
                                    <button onClick={()=>{setTab('worship'); setModalOpen(null);}} className="p-6 rounded-2xl border-2 border-slate-100 hover:border-brand-500 hover:bg-brand-50 flex flex-col items-center gap-3 transition-all group">
                                        <div className="p-3 bg-brand-100 text-brand-600 rounded-full group-hover:scale-110 transition-transform"><Icon name="Music" size={24}/></div>
                                        <span className="text-sm font-bold text-slate-700">Alabanza</span>
                                    </button>
                                    <button onClick={()=>{setTab('servers'); setModalOpen(null);}} className="p-6 rounded-2xl border-2 border-slate-100 hover:border-blue-500 hover:bg-blue-50 flex flex-col items-center gap-3 transition-all group">
                                        <div className="p-3 bg-blue-100 text-blue-600 rounded-full group-hover:scale-110 transition-transform"><Icon name="Hand" size={24}/></div>
                                        <span className="text-sm font-bold text-slate-700">Servidores</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* MODAL DETALLE EVENTO */}
                    {modalOpen === 'eventDetail' && (
                        <EventDetailModal date={selectedDateForDetail} data={data} onClose={()=>setModalOpen(null)} />
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
