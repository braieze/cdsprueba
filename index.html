<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plataforma Conquistadores</title>
    
    <!-- Scripts Base -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Librer√≠a de Gr√°ficos (con manejo de errores si falla) -->
    <script src="https://unpkg.com/recharts/umd/Recharts.min.js"></script>
    
    <!-- Fuente Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: { 50:'#fff7ed', 100:'#ffedd5', 500:'#f97316', 600:'#ea580c', 700:'#c2410c', 900:'#7c2d12' }
                    },
                    fontFamily: { sans: ['Inter', 'sans-serif'] }
                }
            }
        }
    </script>
    <style>
        body { font-family: 'Inter', sans-serif; background: #f8fafc; }
        .fade-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        /* Scrollbar oculta pero funcional */
        .hide-scroll::-webkit-scrollbar { display: none; }
        .hide-scroll { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // --- MANEJO SEGURO DE RECHARTS ---
        // Si la librer√≠a no carga, usamos un objeto vac√≠o para evitar que la app explote
        const RechartsObj = window.Recharts || {};
        const { AreaChart, Area, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer } = RechartsObj;
        const chartsAvailable = !!window.Recharts;

        // --- ICONOS CORREGIDOS (Todos envueltos en React.Fragment) ---
        const Icons = {
            Home: <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>,
            // CORRECCI√ìN AQU√ç: Fragment para envolver m√∫ltiples paths
            Users: <React.Fragment><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></React.Fragment>,
            Wallet: <React.Fragment><path d="M20 12V8H6a2 2 0 0 1 0-4h14v4"/><path d="M4 6v12a2 2 0 0 0 2 2h14v-4"/><path d="M18 12a2 2 0 0 0 0 4h4v-4z"/></React.Fragment>,
            Music: <React.Fragment><path d="M9 18V5l12-2v13"/><circle cx="6" cy="18" r="3"/><circle cx="18" cy="16" r="3"/></React.Fragment>,
            Book: <React.Fragment><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></React.Fragment>,
            Smile: <React.Fragment><circle cx="12" cy="12" r="10"/><path d="M8 14s1.5 2 4 2 4-2 4-2"/><line x1="9" y1="9" x2="9.01" y2="9"/><line x1="15" y1="9" x2="15.01" y2="9"/></React.Fragment>,
            Bell: <React.Fragment><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></React.Fragment>,
            Calendar: <React.Fragment><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></React.Fragment>,
            LogOut: <React.Fragment><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></React.Fragment>,
            Plus: <React.Fragment><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></React.Fragment>,
            X: <React.Fragment><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></React.Fragment>,
            Menu: <React.Fragment><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></React.Fragment>,
            Search: <React.Fragment><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></React.Fragment>,
            Mail: <React.Fragment><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></React.Fragment>,
            ChevronRight: <polyline points="9 18 15 12 9 6"/>,
            Trash: <React.Fragment><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></React.Fragment>
        };

        const Icon = ({ name, size = 20, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {Icons[name] || <circle cx="12" cy="12" r="10"/>}
            </svg>
        );

        // --- DATOS INICIALES ---
        const INITIAL_DATA = {
            members: [
                { id: 1, name: 'Pastor Roberto', role: 'Pastor', ministry: 'Pastoral', phone: '11-5555-0001', photo: 'https://ui-avatars.com/api/?name=Roberto+Perez&background=0d9488&color=fff', status: 'Activo', birth: '1975-05-20', address: 'Av. Principal 123', visits: 52, lastVisit: '2023-11-26', notes: [] },
                { id: 2, name: 'Lucas Diaz', role: 'L√≠der', ministry: 'Alabanza', phone: '11-5555-0002', photo: 'https://ui-avatars.com/api/?name=Lucas+Diaz&background=ea580c&color=fff', status: 'Activo', birth: '1995-03-15', address: 'Calle 4 nro 500', visits: 48, lastVisit: '2023-11-26', notes: ['Se le asign√≥ llave de sala de ensayo.'] },
                { id: 3, name: 'Sofia M.', role: 'L√≠der', ministry: 'EBD', phone: '11-5555-0003', photo: 'https://ui-avatars.com/api/?name=Sofia+M&background=0891b2&color=fff', status: 'Activo', birth: '1990-08-10', address: 'Barrio Norte', visits: 45, lastVisit: '2023-11-26', notes: [] },
                { id: 4, name: 'Javier K.', role: 'L√≠der', ministry: 'J√≥venes', phone: '11-5555-0004', photo: 'https://ui-avatars.com/api/?name=Javier+K&background=7c3aed&color=fff', status: 'Activo', birth: '2000-12-01', address: 'Centro', visits: 40, lastVisit: '2023-11-19', notes: [] },
                { id: 5, name: 'Maria Gomez', role: 'Miembro', ministry: 'General', phone: '11-5555-0005', photo: 'https://ui-avatars.com/api/?name=Maria+G&background=64748b&color=fff', status: 'Activo', birth: '1985-02-14', address: 'Calle 2', visits: 12, lastVisit: '2023-10-15', notes: ['Visitar pr√≥xima semana.'] },
            ],
            finances: [
                { id: 1, date: '2023-11-26', type: 'Culto', cash: 45000, transfer: 32000, tithesCount: 15, notes: 'Culto Dominical' },
                { id: 2, date: '2023-11-19', type: 'Culto', cash: 38000, transfer: 28000, tithesCount: 12, notes: 'Culto Dominical' },
                { id: 3, date: '2023-11-28', type: 'Gasto', cash: -5000, transfer: 0, tithesCount: 0, notes: 'Compra Art√≠culos Limpieza' },
            ],
            worship: [
                { id: 1, date: '2023-12-03', theme: 'Domingo de Victoria', songs: ['Tu Fidelidad', 'Cuerdas de Amor', 'Digno'], team: { Vocal: ['Lucas Diaz', 'Sofia M.'], Guitarra: ['Lucas Diaz'], Bateria: [], Bajo: [] } },
                { id: 2, date: '2023-12-10', theme: 'Navidad Anticipada', songs: ['Noche de Paz', 'Vino Celestial'], team: { Vocal: ['Lucas Diaz'], Guitarra: [], Bateria: [], Bajo: [] } }
            ],
            ebd: [
                { id: 1, date: '2023-12-03', topic: 'La Creaci√≥n', teachers: ['Sofia M.'], students: 15 },
                { id: 2, date: '2023-12-10', topic: 'El Arca de No√©', teachers: ['Sofia M.'], students: 0 }
            ],
            youth: [
                { id: 1, date: '2023-12-02', title: 'Noche de Cine', location: 'SUM Iglesia', notes: 'Traer refrescos' }
            ],
            messages: [
                { id: 1, from: 'Pastor Roberto', to: 'L√≠deres', content: 'Reuni√≥n de planificaci√≥n este s√°bado 18hs.', date: '2023-11-28' },
                { id: 2, from: 'Sistema', to: 'Todos', content: 'Recordatorio: Ensayo general viernes 20hs.', date: '2023-11-27' }
            ]
        };

        // --- COMPONENTES UI REUTILIZABLES ---
        const Card = ({ children, className = "" }) => (
            <div className={`bg-white rounded-2xl shadow-sm border border-slate-100 p-6 ${className}`}>{children}</div>
        );

        const Modal = ({ isOpen, onClose, title, children }) => {
            if (!isOpen) return null;
            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-slate-900/50 backdrop-blur-sm fade-in">
                    <div className="bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto">
                        <div className="p-5 border-b border-slate-100 flex justify-between items-center sticky top-0 bg-white z-10">
                            <h3 className="text-xl font-bold text-slate-800">{title}</h3>
                            <button onClick={onClose} className="p-2 hover:bg-slate-100 rounded-full transition-colors"><Icon name="X" /></button>
                        </div>
                        <div className="p-6">{children}</div>
                    </div>
                </div>
            );
        };

        const Badge = ({ children, type = 'default' }) => {
            const styles = {
                default: "bg-slate-100 text-slate-600",
                success: "bg-emerald-100 text-emerald-700",
                warning: "bg-amber-100 text-amber-700",
                danger: "bg-red-100 text-red-700",
                brand: "bg-brand-100 text-brand-700",
            };
            return <span className={`px-2.5 py-0.5 rounded-full text-xs font-bold uppercase tracking-wide ${styles[type] || styles.default}`}>{children}</span>;
        };

        const Button = ({ children, onClick, variant = 'primary', className = "", icon }) => {
            const variants = {
                primary: "bg-brand-600 text-white hover:bg-brand-700 shadow-lg shadow-brand-500/30",
                secondary: "bg-white text-slate-700 border border-slate-200 hover:bg-slate-50",
                danger: "bg-red-50 text-red-600 border border-red-100 hover:bg-red-100"
            };
            return (
                <button onClick={onClick} className={`flex items-center justify-center gap-2 px-4 py-2.5 rounded-xl font-semibold transition-all active:scale-95 ${variants[variant]} ${className}`}>
                    {icon && <Icon name={icon} size={18} />}
                    {children}
                </button>
            );
        };

        // --- M√ìDULOS ---

        // 1. DASHBOARD
        const Dashboard = ({ user, data }) => {
            const myServices = useMemo(() => {
                const services = [];
                data.worship.forEach(s => {
                    const isVocal = s.team.Vocal.includes(user.name);
                    const isGuitar = s.team.Guitarra.includes(user.name);
                    if (isVocal || isGuitar || user.ministry === 'Alabanza') {
                        services.push({ ...s, area: 'Alabanza', role: isVocal ? 'Vocal' : (isGuitar ? 'Guitarra' : 'L√≠der') });
                    }
                });
                data.ebd.forEach(c => {
                    if (c.teachers.includes(user.name) || user.ministry === 'EBD') services.push({ ...c, area: 'EBD', theme: c.topic });
                });
                return services.sort((a,b) => new Date(a.date) - new Date(b.date));
            }, [data, user]);

            const totalBalance = data.finances.reduce((acc, curr) => acc + curr.cash + curr.transfer, 0);

            return (
                <div className="space-y-6 fade-in">
                    <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                        <div>
                            <h2 className="text-3xl font-bold text-slate-800">Hola, {user.name.split(' ')[0]} üëã</h2>
                            <p className="text-slate-500 font-medium">Panel de {user.role}</p>
                        </div>
                        {user.role === 'Pastor' && (
                            <div className="bg-white p-2 pr-6 rounded-2xl shadow-sm border border-slate-100 flex items-center gap-4">
                                <div className="bg-brand-100 p-3 rounded-xl text-brand-600"><Icon name="Wallet" /></div>
                                <div>
                                    <p className="text-xs font-bold text-slate-400 uppercase">Tesorer√≠a Actual</p>
                                    <p className="text-xl font-bold text-slate-800">${totalBalance.toLocaleString()}</p>
                                </div>
                            </div>
                        )}
                    </div>

                    {/* Alerta de Servicios */}
                    <Card className="border-l-4 border-l-brand-500 bg-gradient-to-r from-brand-50 to-white">
                        <div className="flex justify-between items-center mb-4">
                            <h3 className="font-bold text-slate-800 flex items-center gap-2"><Icon name="Bell" size={18} className="text-brand-600"/> TUS PR√ìXIMOS SERVICIOS</h3>
                        </div>
                        {myServices.length > 0 ? (
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                {myServices.slice(0,3).map((s, i) => (
                                    <div key={i} className="bg-white p-3 rounded-xl border border-brand-100 shadow-sm flex flex-col gap-1">
                                        <div className="flex justify-between">
                                            <Badge type="brand">{s.area}</Badge>
                                            <span className="text-xs font-bold text-slate-400">{new Date(s.date+'T00:00:00').toLocaleDateString('es-AR', {day:'numeric', month:'short'})}</span>
                                        </div>
                                        <p className="font-bold text-sm text-slate-800 truncate">{s.theme || s.topic}</p>
                                        <p className="text-xs text-slate-500">Rol: {s.role || 'Colaborador'}</p>
                                    </div>
                                ))}
                            </div>
                        ) : <p className="text-slate-500 italic text-sm">No tienes servicios asignados pr√≥ximamente.</p>}
                    </Card>

                    <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div className="lg:col-span-2 space-y-6">
                            {user.role === 'Pastor' && (
                                <Card>
                                    <h3 className="font-bold text-slate-800 mb-4 flex items-center gap-2"><Icon name="Wallet"/> Evoluci√≥n de Ofrendas</h3>
                                    <div className="h-64 bg-slate-50 rounded-xl overflow-hidden relative">
                                        {chartsAvailable ? (
                                            <ResponsiveContainer width="100%" height="100%">
                                                <AreaChart data={data.finances.filter(f => f.type === 'Culto')}>
                                                    <defs>
                                                        <linearGradient id="colorCash" x1="0" y1="0" x2="0" y2="1">
                                                            <stop offset="5%" stopColor="#f97316" stopOpacity={0.8}/>
                                                            <stop offset="95%" stopColor="#f97316" stopOpacity={0}/>
                                                        </linearGradient>
                                                    </defs>
                                                    <CartesianGrid strokeDasharray="3 3" vertical={false} stroke="#e2e8f0"/>
                                                    <XAxis dataKey="date" tickFormatter={(d) => new Date(d+'T00:00:00').getDate()} axisLine={false} tickLine={false} />
                                                    <YAxis axisLine={false} tickLine={false} tickFormatter={(v) => `$${v/1000}k`} />
                                                    <Tooltip formatter={(value) => `$${value}`} />
                                                    <Area type="monotone" dataKey="cash" stroke="#f97316" fillOpacity={1} fill="url(#colorCash)" />
                                                </AreaChart>
                                            </ResponsiveContainer>
                                        ) : (
                                            <div className="flex items-center justify-center h-full text-slate-400 flex-col">
                                                <Icon name="Wallet" size={32} className="mb-2"/>
                                                <p>Gr√°fico no disponible</p>
                                            </div>
                                        )}
                                    </div>
                                </Card>
                            )}
                            <Card>
                                <h3 className="font-bold text-slate-800 mb-4 flex items-center gap-2"><Icon name="Mail"/> Mensajes Recientes</h3>
                                <div className="space-y-4">
                                    {data.messages.map(m => (
                                        <div key={m.id} className="flex gap-4 p-3 rounded-xl bg-slate-50 border border-slate-100">
                                            <div className="w-10 h-10 rounded-full bg-indigo-100 text-indigo-600 flex items-center justify-center font-bold text-sm shrink-0">
                                                {m.from.substring(0,2)}
                                            </div>
                                            <div>
                                                <div className="flex justify-between w-full mb-1">
                                                    <p className="font-bold text-sm text-slate-800">{m.from}</p>
                                                    <span className="text-[10px] text-slate-400">{m.date}</span>
                                                </div>
                                                <p className="text-sm text-slate-600">{m.content}</p>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </Card>
                        </div>
                        
                        <div className="space-y-6">
                            <Card className="bg-slate-800 text-white">
                                <h3 className="font-bold mb-4 flex items-center gap-2"><Icon name="Calendar"/> Calendario General</h3>
                                <div className="space-y-3">
                                    {[...data.worship, ...data.ebd, ...data.youth]
                                        .sort((a,b) => new Date(a.date) - new Date(b.date))
                                        .slice(0, 5)
                                        .map((e, i) => (
                                            <div key={i} className="flex gap-3 items-center border-b border-slate-700 pb-2 last:border-0 last:pb-0">
                                                <div className="bg-slate-700 p-2 rounded text-center min-w-[3.5rem]">
                                                    <span className="block text-xl font-bold leading-none">{new Date(e.date+'T00:00:00').getDate()}</span>
                                                    <span className="text-[10px] uppercase text-slate-400">{new Date(e.date+'T00:00:00').toLocaleDateString('es-AR', {month:'short'})}</span>
                                                </div>
                                                <div>
                                                    <p className="font-semibold text-sm truncate">{e.theme || e.topic || e.title}</p>
                                                    <p className="text-xs text-slate-400">{e.songs ? 'Culto' : (e.topic ? 'Clase EBD' : 'J√≥venes')}</p>
                                                </div>
                                            </div>
                                        ))}
                                </div>
                            </Card>
                        </div>
                    </div>
                </div>
            );
        };

        // 2. DIRECTORIO
        const Directory = ({ data, setData, user }) => {
            const [selectedMember, setSelectedMember] = useState(null);
            const [searchTerm, setSearchTerm] = useState("");
            const [isAdding, setIsAdding] = useState(false);
            const [newMember, setNewMember] = useState({});

            const handleAddMember = () => {
                const member = { ...newMember, id: Date.now(), visits: 0, notes: [], photo: `https://ui-avatars.com/api/?name=${newMember.name}&background=random` };
                setData(prev => ({ ...prev, members: [...prev.members, member] }));
                setIsAdding(false);
            };

            const filteredMembers = data.members.filter(m => m.name.toLowerCase().includes(searchTerm.toLowerCase()) || m.ministry.toLowerCase().includes(searchTerm.toLowerCase()));

            return (
                <div className="space-y-6 fade-in">
                    <div className="flex flex-col md:flex-row justify-between items-center gap-4">
                        <div className="relative w-full md:w-96">
                            <span className="absolute left-3 top-3 text-slate-400"><Icon name="Search" size={18}/></span>
                            <input 
                                type="text" 
                                placeholder="Buscar por nombre o ministerio..." 
                                className="w-full pl-10 pr-4 py-2.5 rounded-xl border border-slate-200 focus:outline-none focus:ring-2 focus:ring-brand-500"
                                value={searchTerm}
                                onChange={(e) => setSearchTerm(e.target.value)}
                            />
                        </div>
                        <Button icon="Plus" onClick={() => setIsAdding(true)}>Nuevo Miembro</Button>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                        {filteredMembers.map(m => (
                            <div key={m.id} className="bg-white rounded-2xl p-5 border border-slate-100 shadow-sm hover:shadow-md transition-shadow cursor-pointer relative" onClick={() => setSelectedMember(m)}>
                                <div className="absolute top-4 right-4">
                                    <Badge type={m.status === 'Activo' ? 'success' : 'danger'}>{m.status}</Badge>
                                </div>
                                <div className="flex flex-col items-center text-center mt-2">
                                    <img src={m.photo} alt={m.name} className="w-20 h-20 rounded-full object-cover mb-3 ring-4 ring-slate-50"/>
                                    <h3 className="font-bold text-slate-800 text-lg">{m.name}</h3>
                                    <p className="text-sm text-brand-600 font-semibold">{m.role} ‚Ä¢ {m.ministry}</p>
                                    
                                    <div className="mt-4 w-full bg-slate-50 p-3 rounded-xl border border-slate-100">
                                        <div className="flex justify-between text-xs font-bold text-slate-500 mb-1">
                                            <span>Asistencia</span>
                                            <span>{m.visits} visitas</span>
                                        </div>
                                        <div className="h-2 bg-slate-200 rounded-full overflow-hidden">
                                            <div className="h-full bg-brand-500 rounded-full" style={{width: `${Math.min(m.visits, 100)}%`}}></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        ))}
                    </div>

                    <Modal isOpen={!!selectedMember} onClose={() => setSelectedMember(null)} title="Ficha T√©cnica">
                        {selectedMember && (
                            <div className="space-y-6">
                                <div className="flex gap-6 items-start">
                                    <img src={selectedMember.photo} className="w-24 h-24 rounded-2xl bg-slate-100 object-cover" />
                                    <div className="flex-1">
                                        <div className="flex justify-between">
                                            <h2 className="text-2xl font-bold text-slate-800">{selectedMember.name}</h2>
                                            <Badge type="brand">{selectedMember.role}</Badge>
                                        </div>
                                        <p className="text-slate-500 mb-2">{selectedMember.ministry}</p>
                                        <div className="grid grid-cols-2 gap-2 text-sm">
                                            <div className="bg-slate-50 p-2 rounded">üéÇ {new Date().getFullYear() - new Date(selectedMember.birth).getFullYear()} a√±os</div>
                                            <div className="bg-slate-50 p-2 rounded">üìû {selectedMember.phone}</div>
                                        </div>
                                    </div>
                                </div>
                                <div className="border-t border-slate-100 pt-4">
                                    <h4 className="font-bold text-slate-800 mb-2">Notas de Seguimiento</h4>
                                    <div className="bg-amber-50 border border-amber-100 rounded-xl p-4 space-y-2">
                                        {selectedMember.notes.length > 0 ? selectedMember.notes.map((n,i) => (
                                            <p key={i} className="text-sm text-amber-900 border-b border-amber-200 last:border-0 pb-1 last:pb-0">‚Ä¢ {n}</p>
                                        )) : <p className="text-sm text-amber-700 italic">No hay notas registradas.</p>}
                                    </div>
                                </div>
                                {user.role === 'Pastor' && (
                                    <div className="flex justify-end pt-4">
                                        <Button variant="danger" icon="Trash">Eliminar Miembro</Button>
                                    </div>
                                )}
                            </div>
                        )}
                    </Modal>

                    <Modal isOpen={isAdding} onClose={() => setIsAdding(false)} title="Nuevo Miembro">
                        <div className="grid grid-cols-1 gap-4">
                            <input className="w-full p-3 border rounded-lg" placeholder="Nombre Completo" onChange={e => setNewMember({...newMember, name: e.target.value})} />
                            <div className="grid grid-cols-2 gap-4">
                                <input className="p-3 border rounded-lg" type="date" onChange={e => setNewMember({...newMember, birth: e.target.value})} />
                                <input className="p-3 border rounded-lg" placeholder="Tel√©fono" onChange={e => setNewMember({...newMember, phone: e.target.value})} />
                            </div>
                            <div className="grid grid-cols-2 gap-4">
                                <select className="p-3 border rounded-lg bg-white" onChange={e => setNewMember({...newMember, role: e.target.value})}>
                                    <option>Miembro</option><option>L√≠der</option><option>Pastor</option>
                                </select>
                                <select className="p-3 border rounded-lg bg-white" onChange={e => setNewMember({...newMember, ministry: e.target.value})}>
                                    <option>General</option><option>Alabanza</option><option>EBD</option><option>J√≥venes</option>
                                </select>
                            </div>
                            <Button onClick={handleAddMember} className="w-full">Guardar Ficha</Button>
                        </div>
                    </Modal>
                </div>
            );
        };

        // 3. MINISTERIO DE ALABANZA
        const Worship = ({ data, setData }) => {
            const [isPlanning, setIsPlanning] = useState(false);
            const [newService, setNewService] = useState({ date: '', theme: '', songs: [], team: { Vocal: [], Guitarra: [], Bateria: [], Bajo: [] } });
            
            const musicians = data.members.filter(m => m.ministry === 'Alabanza' || m.role === 'Pastor');
            
            const handleAddSong = () => {
                const song = prompt("Nombre de la canci√≥n:");
                if(song) setNewService(prev => ({...prev, songs: [...prev.songs, song]}));
            };

            const toggleMusician = (role, name) => {
                setNewService(prev => {
                    const current = prev.team[role];
                    const updated = current.includes(name) ? current.filter(n => n !== name) : [...current, name];
                    return { ...prev, team: { ...prev.team, [role]: updated } };
                });
            };

            const saveService = () => {
                setData(prev => ({ ...prev, worship: [...prev.worship, { ...newService, id: Date.now() }] }));
                setIsPlanning(false);
            };

            return (
                <div className="space-y-6 fade-in">
                    <div className="flex justify-between items-center">
                        <h2 className="text-2xl font-bold text-slate-800">Ministerio de Alabanza</h2>
                        <Button icon="Plus" onClick={() => setIsPlanning(true)}>Planificar Culto</Button>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                        {data.worship.map(s => (
                            <Card key={s.id} className="relative overflow-hidden">
                                <div className="absolute top-0 left-0 w-2 h-full bg-brand-500"></div>
                                <div className="flex justify-between mb-4 pl-2">
                                    <h3 className="font-bold text-xl">{s.theme}</h3>
                                    <Badge>{new Date(s.date+'T00:00:00').toLocaleDateString('es-AR')}</Badge>
                                </div>
                                <div className="space-y-4 pl-2">
                                    <div className="bg-slate-50 p-3 rounded-lg">
                                        <p className="text-xs font-bold text-slate-400 uppercase mb-2">Setlist</p>
                                        <ul className="list-disc list-inside text-sm text-slate-700">
                                            {s.songs.map((song, i) => <li key={i}>{song}</li>)}
                                        </ul>
                                    </div>
                                    <div>
                                        <p className="text-xs font-bold text-slate-400 uppercase mb-2">Equipo</p>
                                        <div className="flex flex-wrap gap-2">
                                            {Object.entries(s.team).map(([role, members]) => members.length > 0 && (
                                                <span key={role} className="text-xs bg-indigo-50 text-indigo-700 px-2 py-1 rounded border border-indigo-100">
                                                    <b>{role}:</b> {members.join(', ')}
                                                </span>
                                            ))}
                                        </div>
                                    </div>
                                </div>
                            </Card>
                        ))}
                    </div>

                    <Modal isOpen={isPlanning} onClose={() => setIsPlanning(false)} title="Planificador de Alabanza">
                        <div className="space-y-4">
                            <div className="grid grid-cols-2 gap-4">
                                <div><label className="text-xs font-bold uppercase text-slate-500">Fecha</label><input type="date" className="w-full border p-2 rounded" onChange={e => setNewService({...newService, date: e.target.value})}/></div>
                                <div><label className="text-xs font-bold uppercase text-slate-500">Tema</label><input type="text" className="w-full border p-2 rounded" placeholder="Ej: Domingo de Gracia" onChange={e => setNewService({...newService, theme: e.target.value})}/></div>
                            </div>
                            <div>
                                <div className="flex justify-between items-center mb-2">
                                    <label className="text-xs font-bold uppercase text-slate-500">Canciones</label>
                                    <button onClick={handleAddSong} className="text-xs text-brand-600 font-bold">+ Agregar</button>
                                </div>
                                <div className="flex flex-wrap gap-2 p-3 bg-slate-50 rounded-lg min-h-[3rem]">
                                    {newService.songs.map((s,i) => <Badge key={i} type="brand">{s}</Badge>)}
                                </div>
                            </div>
                            <div className="border-t pt-2">
                                <label className="text-xs font-bold uppercase text-slate-500 mb-2 block">Armado de Banda</label>
                                {['Vocal', 'Guitarra', 'Bateria', 'Bajo'].map(inst => (
                                    <div key={inst} className="mb-3">
                                        <p className="text-xs font-bold text-slate-700 mb-1">{inst}</p>
                                        <div className="flex flex-wrap gap-1">
                                            {musicians.map(m => (
                                                <button key={m.id} 
                                                    onClick={() => toggleMusician(inst, m.name)}
                                                    className={`text-xs px-2 py-1 rounded border transition-colors ${newService.team[inst].includes(m.name) ? 'bg-brand-600 text-white border-brand-600' : 'bg-white text-slate-600 hover:bg-slate-50'}`}>
                                                    {m.name}
                                                </button>
                                            ))}
                                        </div>
                                    </div>
                                ))}
                            </div>
                            <Button onClick={saveService} className="w-full">Guardar Planificaci√≥n</Button>
                        </div>
                    </Modal>
                </div>
            );
        };

        // 4. TESORER√çA (Solo Pastor)
        const Finances = ({ data, setData }) => {
            const [isClosing, setIsClosing] = useState(false);
            const [closure, setClosure] = useState({ date: '', cash: 0, transfer: 0, tithesCount: 0, notes: '' });

            const handleCloseService = () => {
                setData(prev => ({ ...prev, finances: [{ ...closure, id: Date.now(), type: 'Culto' }, ...prev.finances] }));
                setIsClosing(false);
            };

            return (
                <div className="space-y-6 fade-in">
                    <div className="flex justify-between items-center">
                        <h2 className="text-2xl font-bold text-slate-800">Tesorer√≠a Eclesi√°stica</h2>
                        <Button icon="Plus" onClick={() => setIsClosing(true)}>Nuevo Cierre de Culto</Button>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <Card className="bg-brand-600 text-white shadow-brand-500/40 shadow-lg">
                            <p className="text-brand-100 font-medium text-sm">Total en Caja (General)</p>
                            <p className="text-3xl font-bold mt-1">${data.finances.reduce((acc, f) => acc + f.cash + f.transfer, 0).toLocaleString()}</p>
                        </Card>
                        <Card>
                            <p className="text-slate-400 font-bold text-xs uppercase">Promedio Mensual</p>
                            <p className="text-2xl font-bold text-slate-800 mt-1">$125,000</p>
                        </Card>
                        <Card>
                            <p className="text-slate-400 font-bold text-xs uppercase">Diezmantes Activos</p>
                            <p className="text-2xl font-bold text-slate-800 mt-1">24 Familias</p>
                        </Card>
                    </div>

                    <Card>
                        <h3 className="font-bold text-slate-800 mb-4">Movimientos Recientes</h3>
                        <div className="overflow-x-auto">
                            <table className="w-full text-sm text-left">
                                <thead className="bg-slate-50 text-slate-500 font-bold uppercase text-xs">
                                    <tr>
                                        <th className="p-3 rounded-l-lg">Fecha</th>
                                        <th className="p-3">Detalle</th>
                                        <th className="p-3 text-right">Efectivo</th>
                                        <th className="p-3 text-right">Banco</th>
                                        <th className="p-3 text-center rounded-r-lg">Diezmantes</th>
                                    </tr>
                                </thead>
                                <tbody className="divide-y divide-slate-100">
                                    {data.finances.map(f => (
                                        <tr key={f.id} className="hover:bg-slate-50 transition-colors">
                                            <td className="p-3 font-medium">{new Date(f.date+'T00:00:00').toLocaleDateString('es-AR')}</td>
                                            <td className="p-3">
                                                <Badge type={f.type === 'Gasto' ? 'danger' : 'success'}>{f.type}</Badge>
                                                <span className="ml-2 text-slate-600">{f.notes}</span>
                                            </td>
                                            <td className={`p-3 text-right font-mono ${f.cash < 0 ? 'text-red-500' : 'text-slate-700'}`}>${f.cash.toLocaleString()}</td>
                                            <td className="p-3 text-right font-mono text-slate-700">${f.transfer.toLocaleString()}</td>
                                            <td className="p-3 text-center text-slate-500">{f.tithesCount > 0 ? f.tithesCount : '-'}</td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    </Card>

                    <Modal isOpen={isClosing} onClose={() => setIsClosing(false)} title="Cierre de Culto / Movimiento">
                        <div className="space-y-4">
                            <input type="date" className="w-full border p-3 rounded-lg" onChange={e => setClosure({...closure, date: e.target.value})}/>
                            <input type="text" placeholder="Notas / Detalle del culto" className="w-full border p-3 rounded-lg" onChange={e => setClosure({...closure, notes: e.target.value})}/>
                            <div className="grid grid-cols-2 gap-4">
                                <div><label className="text-xs font-bold uppercase">Efectivo</label><input type="number" className="w-full border p-3 rounded-lg" onChange={e => setClosure({...closure, cash: parseInt(e.target.value)})}/></div>
                                <div><label className="text-xs font-bold uppercase">Transferencia</label><input type="number" className="w-full border p-3 rounded-lg" onChange={e => setClosure({...closure, transfer: parseInt(e.target.value)})}/></div>
                            </div>
                            <div><label className="text-xs font-bold uppercase">Cantidad de Diezmantes</label><input type="number" className="w-full border p-3 rounded-lg" onChange={e => setClosure({...closure, tithesCount: parseInt(e.target.value)})}/></div>
                            <Button onClick={handleCloseService} className="w-full">Registrar Cierre</Button>
                        </div>
                    </Modal>
                </div>
            );
        };

        // 5. ESCUELA B√çBLICA & JOVENES (Gen√©ricos)
        const MinistryModule = ({ title, items, onAdd, type }) => {
            const [isOpen, setIsOpen] = useState(false);
            const [newItem, setNewItem] = useState({});

            const handleSave = () => {
                onAdd({ ...newItem, id: Date.now() });
                setIsOpen(false);
            };

            return (
                <div className="space-y-6 fade-in">
                    <div className="flex justify-between items-center">
                        <h2 className="text-2xl font-bold text-slate-800">{title}</h2>
                        <Button icon="Plus" onClick={() => setIsOpen(true)}>Nuevo Evento/Clase</Button>
                    </div>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        {items.map(i => (
                            <Card key={i.id} className="flex gap-4">
                                <div className="bg-slate-100 p-3 rounded-xl flex flex-col items-center justify-center min-w-[4rem]">
                                    <span className="font-bold text-xl text-slate-800">{new Date(i.date+'T00:00:00').getDate()}</span>
                                    <span className="text-xs uppercase text-slate-500">{new Date(i.date+'T00:00:00').toLocaleDateString('es-AR',{month:'short'})}</span>
                                </div>
                                <div>
                                    <h3 className="font-bold text-lg text-slate-800">{i.topic || i.title}</h3>
                                    <p className="text-sm text-slate-500">{i.teachers ? `Maestros: ${i.teachers.join(', ')}` : i.location}</p>
                                    {i.students !== undefined && <Badge>Alumnos: {i.students}</Badge>}
                                </div>
                            </Card>
                        ))}
                    </div>
                    
                    <Modal isOpen={isOpen} onClose={() => setIsOpen(false)} title={`Nuevo en ${title}`}>
                        <div className="space-y-4">
                            <input type="date" className="w-full border p-3 rounded-lg" onChange={e => setNewItem({...newItem, date: e.target.value})}/>
                            <input type="text" placeholder={type === 'ebd' ? 'Tema de la Clase' : 'T√≠tulo del Evento'} className="w-full border p-3 rounded-lg" onChange={e => setNewItem({...newItem, [type==='ebd'?'topic':'title']: e.target.value})}/>
                            {type === 'ebd' ? (
                                <input type="text" placeholder="Maestros (separar con comas)" className="w-full border p-3 rounded-lg" onChange={e => setNewItem({...newItem, teachers: e.target.value.split(',')})}/>
                            ) : (
                                <input type="text" placeholder="Lugar" className="w-full border p-3 rounded-lg" onChange={e => setNewItem({...newItem, location: e.target.value})}/>
                            )}
                            <Button onClick={handleSave} className="w-full">Guardar</Button>
                        </div>
                    </Modal>
                </div>
            );
        };

        // --- APP PRINCIPAL ---
        const App = () => {
            const [user, setUser] = useState(null);
            const [activeTab, setActiveTab] = useState('dashboard');
            const [data, setData] = useState(INITIAL_DATA);
            const [sidebarOpen, setSidebarOpen] = useState(false);

            const addEBD = (item) => setData(prev => ({...prev, ebd: [...prev.ebd, item]}));
            const addYouth = (item) => setData(prev => ({...prev, youth: [...prev.youth, item]}));

            // LOGIN
            if (!user) {
                return (
                    <div className="min-h-screen flex items-center justify-center bg-slate-50 p-4">
                        <div className="max-w-md w-full bg-white p-8 rounded-3xl shadow-xl">
                            <div className="text-center mb-8">
                                <div className="bg-brand-600 w-16 h-16 rounded-2xl mx-auto flex items-center justify-center text-white mb-4 shadow-lg shadow-brand-500/40">
                                    <Icon name="Home" size={32}/>
                                </div>
                                <h1 className="text-2xl font-bold text-slate-800">Conquistadores App</h1>
                                <p className="text-slate-500">Sistema de Gesti√≥n Integral</p>
                            </div>
                            <div className="space-y-3">
                                {[
                                    { name: 'Pastor Roberto', role: 'Pastor', icon: 'Home', color: 'bg-brand-50 text-brand-700' },
                                    { name: 'Lucas Diaz', role: 'L√≠der Alabanza', ministry: 'Alabanza', icon: 'Music', color: 'bg-blue-50 text-blue-700' },
                                    { name: 'Sofia M.', role: 'L√≠der EBD', ministry: 'EBD', icon: 'Book', color: 'bg-emerald-50 text-emerald-700' },
                                    { name: 'Javier K.', role: 'L√≠der J√≥venes', ministry: 'J√≥venes', icon: 'Smile', color: 'bg-purple-50 text-purple-700' }
                                ].map((u, i) => (
                                    <button key={i} onClick={() => setUser({ name: u.name, role: u.role || 'L√≠der', ministry: u.ministry || 'Pastoral' })} 
                                        className="w-full p-4 border border-slate-200 rounded-xl hover:bg-slate-50 flex items-center gap-4 transition-all hover:scale-[1.02]">
                                        <div className={`p-3 rounded-lg ${u.color}`}><Icon name={u.icon} /></div>
                                        <div className="text-left">
                                            <p className="font-bold text-slate-800">{u.role}</p>
                                            <p className="text-xs text-slate-500">{u.name}</p>
                                        </div>
                                        <Icon name="ChevronRight" className="ml-auto text-slate-300"/>
                                    </button>
                                ))}
                            </div>
                        </div>
                    </div>
                );
            }

            const NavItem = ({ id, icon, label }) => (
                <button 
                    onClick={() => { setActiveTab(id); setSidebarOpen(false); }} 
                    className={`w-full flex items-center gap-3 px-4 py-3 rounded-xl font-medium transition-all mb-1 ${activeTab === id ? 'bg-brand-600 text-white shadow-lg shadow-brand-900/20' : 'text-brand-100/70 hover:bg-brand-800 hover:text-white'}`}>
                    <Icon name={icon} /> {label}
                </button>
            );

            return (
                <div className="flex h-screen bg-slate-50 overflow-hidden">
                    {/* Sidebar */}
                    <aside className={`fixed md:relative z-40 w-72 bg-brand-900 text-white h-full flex flex-col transition-transform duration-300 ${sidebarOpen ? 'translate-x-0' : '-translate-x-full md:translate-x-0'}`}>
                        <div className="p-6">
                            <div className="flex items-center gap-3 mb-8">
                                <div className="bg-white/10 p-2 rounded-lg"><Icon name="Home" /></div>
                                <span className="font-bold text-lg tracking-tight">Conquistadores</span>
                            </div>
                            <nav>
                                <NavItem id="dashboard" icon="Home" label="Inicio" />
                                <NavItem id="directory" icon="Users" label="Directorio" />
                                <div className="my-4 px-4 text-xs font-bold text-brand-500/60 uppercase tracking-widest">Ministerios</div>
                                {(user.role === 'Pastor' || user.ministry === 'Alabanza') && <NavItem id="worship" icon="Music" label="Alabanza" />}
                                {(user.role === 'Pastor' || user.ministry === 'EBD') && <NavItem id="ebd" icon="Book" label="Escuela B√≠blica" />}
                                {(user.role === 'Pastor' || user.ministry === 'J√≥venes') && <NavItem id="youth" icon="Smile" label="J√≥venes" />}
                                {user.role === 'Pastor' && (
                                    <>
                                        <div className="my-4 px-4 text-xs font-bold text-brand-500/60 uppercase tracking-widest">Admin</div>
                                        <NavItem id="finances" icon="Wallet" label="Tesorer√≠a" />
                                        <NavItem id="messages" icon="Mail" label="Mensajer√≠a" />
                                    </>
                                )}
                            </nav>
                        </div>
                        <div className="mt-auto p-6 bg-brand-950">
                            <div className="flex items-center gap-3">
                                <div className="w-10 h-10 rounded-full bg-brand-700 flex items-center justify-center font-bold">{user.name[0]}</div>
                                <div className="flex-1 overflow-hidden">
                                    <p className="font-bold text-sm truncate">{user.name}</p>
                                    <p className="text-xs text-brand-400">{user.role}</p>
                                </div>
                                <button onClick={() => setUser(null)} className="text-brand-400 hover:text-white"><Icon name="LogOut" /></button>
                            </div>
                        </div>
                    </aside>

                    {/* Main Content */}
                    <main className="flex-1 overflow-y-auto relative w-full bg-slate-50">
                        <header className="md:hidden bg-white p-4 sticky top-0 z-30 shadow-sm flex justify-between items-center">
                            <span className="font-bold text-brand-900">Conquistadores</span>
                            <button onClick={() => setSidebarOpen(true)} className="text-slate-600"><Icon name="Menu" /></button>
                        </header>

                        <div className="p-4 md:p-8 max-w-7xl mx-auto pb-24">
                            {activeTab === 'dashboard' && <Dashboard user={user} data={data} />}
                            {activeTab === 'directory' && <Directory data={data} setData={setData} user={user} />}
                            {activeTab === 'worship' && <Worship data={data} setData={setData} />}
                            {activeTab === 'finances' && <Finances data={data} setData={setData} />}
                            {activeTab === 'ebd' && <MinistryModule title="Escuela B√≠blica" items={data.ebd} onAdd={addEBD} type="ebd" />}
                            {activeTab === 'youth' && <MinistryModule title="J√≥venes" items={data.youth} onAdd={addYouth} type="youth" />}
                            {activeTab === 'messages' && (
                                <div className="fade-in">
                                    <h2 className="text-2xl font-bold text-slate-800 mb-6">Mensajer√≠a Masiva</h2>
                                    <Card>
                                        <textarea placeholder="Escribe tu mensaje aqu√≠..." className="w-full border p-4 rounded-xl h-32 mb-4 bg-slate-50 focus:bg-white transition-colors"></textarea>
                                        <div className="flex justify-between items-center">
                                            <select className="border p-2 rounded-lg bg-white"><option>Todos</option><option>L√≠deres</option><option>Alabanza</option></select>
                                            <Button icon="Mail">Enviar Mensaje</Button>
                                        </div>
                                    </Card>
                                </div>
                            )}
                        </div>
                    </main>
                    
                    {/* Overlay M√≥vil */}
                    {sidebarOpen && <div className="fixed inset-0 bg-black/50 z-30 md:hidden" onClick={() => setSidebarOpen(false)}></div>}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
